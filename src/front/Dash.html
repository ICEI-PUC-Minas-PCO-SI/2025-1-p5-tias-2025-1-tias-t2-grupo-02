<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Casa de Repouso Do Jeitinho da Vov칩</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bege-claro: #E6D2B6;
            --cinza-claro: #BEBEBE;
            --preto-suave: #2B2B2B;
            --branco-suave: #F5F3EF;
            --cinza-medio: #9C9C9C;
            --bege-escuro: #D4BF9A;
            --verde-suave: #8BC34A;
            --vermelho-suave: #FF5252;
            --amarelo-suave: #FFC107;
            --azul-suave: #2196F3;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--branco-suave);
            color: var(--preto-suave);
            line-height: 1.6;
        }

        /* Header */
        header {
            background-color: var(--bege-claro);
            padding: 15px 40px;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        header img {
            width: 60px;
            height: 60px;
            margin-right: 20px;
            border-radius: 50%;
        }

        header h1 {
            font-size: 24px;
            font-weight: 500;
            color: var(--preto-suave);
            margin-right: auto;
        }

        header nav {
            display: flex;
            gap: 25px;
        }

        header nav a {
            text-decoration: none;
            color: var(--preto-suave);
            font-weight: 500;
            font-size: 16px;
            padding: 8px 16px;
            border-radius: 5px;
            transition: all 0.3s;
        }

        header nav a:hover {
            background-color: var(--bege-escuro);
        }

        header nav a.active {
            background-color: var(--preto-suave);
            color: var(--branco-suave);
        }

        /* Main Content */
        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .page-header {
            margin-bottom: 40px;
        }

        .page-header h2 {
            font-size: 32px;
            color: var(--preto-suave);
            margin-bottom: 10px;
        }

        .page-header p {
            font-size: 18px;
            color: var(--cinza-medio);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
        }

        .stat-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .stat-number {
            font-size: 36px;
            font-weight: 700;
            color: var(--preto-suave);
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 16px;
            color: var(--cinza-medio);
        }

        .charts-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .chart-card {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        .chart-card h3 {
            font-size: 20px;
            color: var(--preto-suave);
            margin-bottom: 20px;
        }

        .chart-placeholder {
            height: 200px;
            background-color: var(--branco-suave);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--cinza-medio);
            font-size: 14px;
        }

        .recent-activities {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        .recent-activities h3 {
            font-size: 20px;
            color: var(--preto-suave);
            margin-bottom: 20px;
        }

        .activity-item {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--branco-suave);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 18px;
        }

        .activity-icon.medication {
            background-color: var(--verde-suave);
            color: white;
        }

        .activity-icon.patient {
            background-color: var(--azul-suave);
            color: white;
        }

        .activity-icon.alert {
            background-color: var(--vermelho-suave);
            color: white;
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 500;
            color: var(--preto-suave);
            margin-bottom: 5px;
        }

        .activity-time {
            font-size: 12px;
            color: var(--cinza-medio);
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: var(--cinza-medio);
        }

        /* Responsive */
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                text-align: center;
                padding: 20px;
            }

            header nav {
                margin-top: 15px;
                flex-wrap: wrap;
                justify-content: center;
            }

            .main-content {
                padding: 20px 15px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .charts-section {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

<header>
    <img src="logo.jpg" alt="Logo Vov칩">
    <h1>Casa de Repouso Do Jeitinho da Vov칩</h1>
    <nav>
        <a href="principalsistema.html">In칤cio</a>
        <a href="Dash.html" class="active">Dashboard</a>
        <a href="gerenciamento.html">Medicamentos</a>
        <a href="pesquisa_paciente.html">Pacientes</a>
        <a href="relatorio.HTML">Relat칩rios</a>
        <a href="help_page_final.html">Ajuda</a>
    </nav>
</header>

<div class="main-content">
    <div class="page-header">
        <h2>Dashboard</h2>
        <p>Vis칚o geral das opera칞칫es da casa de repouso</p>
    </div>

    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">游논</div>
            <div class="stat-number" id="total-patients">-</div>
            <div class="stat-label">Total de Pacientes</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">游눍</div>
            <div class="stat-number" id="total-medications">-</div>
            <div class="stat-label">Medicamentos Cadastrados</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">丘멆잺</div>
            <div class="stat-number" id="critical-medications">-</div>
            <div class="stat-label">Medicamentos Cr칤ticos</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">游늵</div>
            <div class="stat-number" id="low-stock">-</div>
            <div class="stat-label">Estoque Baixo</div>
        </div>
    </div>

    <div class="charts-section">
        <div class="chart-card">
            <h3>Status dos Medicamentos</h3>
            <div class="chart-placeholder" id="medication-status-chart">
                Carregando gr치fico...
            </div>
        </div>
        <div class="chart-card">
            <h3>Pacientes por Faixa Et치ria</h3>
            <div class="chart-placeholder" id="age-distribution-chart">
                Carregando gr치fico...
            </div>
        </div>
    </div>

    <div class="recent-activities">
        <h3>Atividades Recentes</h3>
        <div id="activities-list">
            <div class="loading">Carregando atividades...</div>
        </div>
    </div>
</div>

<script>
const API_BASE_URL = 'http://localhost:8080/api';

// Fun칞칚o para buscar dados dos pacientes
async function fetchPatients() {
    try {
        const response = await fetch(`${API_BASE_URL}/patients`);
        const patients = await response.json();
        return patients;
    } catch (error) {
        console.error('Erro ao buscar pacientes:', error);
        return [];
    }
}

// Fun칞칚o para buscar dados dos medicamentos
async function fetchMedications() {
    try {
        const response = await fetch(`${API_BASE_URL}/medications`);
        const medications = await response.json();
        return medications;
    } catch (error) {
        console.error('Erro ao buscar medicamentos:', error);
        return [];
    }
}

// Fun칞칚o para atualizar as estat칤sticas
async function updateStats() {
    const patients = await fetchPatients();
    const medications = await fetchMedications();

    // Atualizar contadores
    document.getElementById('total-patients').textContent = patients.length;
    document.getElementById('total-medications').textContent = medications.length;

    // Contar medicamentos cr칤ticos e com estoque baixo
    let criticalCount = 0;
    let lowStockCount = 0;

    medications.forEach(med => {
        if (med.quantity <= 2) {
            criticalCount++;
        } else if (med.quantity <= 10) {
            lowStockCount++;
        }
    });

    document.getElementById('critical-medications').textContent = criticalCount;
    document.getElementById('low-stock').textContent = lowStockCount;
}

// Fun칞칚o para criar gr치fico simples de status dos medicamentos
function createMedicationStatusChart(medications) {
    const statusCounts = { OK: 0, BAIXO: 0, CRITICO: 0 };
    
    medications.forEach(med => {
        if (med.quantity <= 2) {
            statusCounts.CRITICO++;
        } else if (med.quantity <= 10) {
            statusCounts.BAIXO++;
        } else {
            statusCounts.OK++;
        }
    });

    const chartElement = document.getElementById('medication-status-chart');
    chartElement.innerHTML = `
        <div style="display: flex; flex-direction: column; gap: 10px;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <span>OK (${statusCounts.OK})</span>
                <div style="width: 60%; height: 20px; background-color: #8BC34A; border-radius: 10px;"></div>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <span>Baixo (${statusCounts.BAIXO})</span>
                <div style="width: ${statusCounts.BAIXO * 10}%; height: 20px; background-color: #FFC107; border-radius: 10px;"></div>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <span>Cr칤tico (${statusCounts.CRITICO})</span>
                <div style="width: ${statusCounts.CRITICO * 15}%; height: 20px; background-color: #FF5252; border-radius: 10px;"></div>
            </div>
        </div>
    `;
}

// Fun칞칚o para criar gr치fico de distribui칞칚o de idade
function createAgeDistributionChart(patients) {
    const ageGroups = { '60-70': 0, '70-80': 0, '80-90': 0, '90+': 0 };
    
    patients.forEach(patient => {
        const birthYear = new Date(patient.birthdate).getFullYear();
        const age = new Date().getFullYear() - birthYear;
        
        if (age >= 90) {
            ageGroups['90+']++;
        } else if (age >= 80) {
            ageGroups['80-90']++;
        } else if (age >= 70) {
            ageGroups['70-80']++;
        } else {
            ageGroups['60-70']++;
        }
    });

    const chartElement = document.getElementById('age-distribution-chart');
    chartElement.innerHTML = `
        <div style="display: flex; flex-direction: column; gap: 10px;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <span>60-70 anos (${ageGroups['60-70']})</span>
                <div style="width: ${ageGroups['60-70'] * 20}%; height: 20px; background-color: #2196F3; border-radius: 10px;"></div>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <span>70-80 anos (${ageGroups['70-80']})</span>
                <div style="width: ${ageGroups['70-80'] * 20}%; height: 20px; background-color: #8BC34A; border-radius: 10px;"></div>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <span>80-90 anos (${ageGroups['80-90']})</span>
                <div style="width: ${ageGroups['80-90'] * 20}%; height: 20px; background-color: #FFC107; border-radius: 10px;"></div>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <span>90+ anos (${ageGroups['90+']})</span>
                <div style="width: ${ageGroups['90+'] * 20}%; height: 20px; background-color: #FF5252; border-radius: 10px;"></div>
            </div>
        </div>
    `;
}

// Fun칞칚o para mostrar atividades recentes
function showRecentActivities(patients, medications) {
    const activitiesElement = document.getElementById('activities-list');
    
    const activities = [
        {
            icon: 'medication',
            title: 'Medicamento com estoque baixo detectado',
            time: 'H치 2 horas',
            type: 'alert'
        },
        {
            icon: 'patient',
            title: 'Novo paciente cadastrado',
            time: 'H치 4 horas',
            type: 'patient'
        },
        {
            icon: 'medication',
            title: 'Medicamento administrado',
            time: 'H치 6 horas',
            type: 'medication'
        }
    ];

    activitiesElement.innerHTML = activities.map(activity => `
        <div class="activity-item">
            <div class="activity-icon ${activity.icon}">
                ${activity.icon === 'medication' ? '游눍' : activity.icon === 'patient' ? '游녻' : '丘멆잺'}
            </div>
            <div class="activity-content">
                <div class="activity-title">${activity.title}</div>
                <div class="activity-time">${activity.time}</div>
            </div>
        </div>
    `).join('');
}

// Inicializar dashboard
async function initDashboard() {
    await updateStats();
    
    const patients = await fetchPatients();
    const medications = await fetchMedications();
    
    createMedicationStatusChart(medications);
    createAgeDistributionChart(patients);
    showRecentActivities(patients, medications);
}

// Carregar dashboard quando a p치gina estiver pronta
document.addEventListener('DOMContentLoaded', initDashboard);

// Atualizar dados a cada 30 segundos
setInterval(updateStats, 30000);
</script>

</body>
</html>

